# 密集描述混合检索重构 - 所需模型清单

## 模型下载说明

请将以下模型下载并保存到 `../models/{模型名称}/` 目录下。

## 必须下载的模型

### 1. 密集描述生成模型
- **模型名称**: `mm_grounding_dino_tiny_o365v1_goldg_grit_v3det`
- **完整路径**: `../models/mm_grounding_dino_tiny_o365v1_goldg_grit_v3det/`
- **用途**: 为每张图像生成5-10个密集描述短语
- **说明**: 
  - 这是一个基于Grounding DINO的模型，用于密集区域描述生成
  - **重要提示**: HuggingFace仓库通常只包含`config.json`，但mmdetection需要`config.py`文件
  - 模型文件应包含：
    - **`config.py`** - mmdetection配置文件（必需，需要单独下载）
    - 检查点文件（`.pth`、`.ckpt`、`pytorch_model.bin`等）
  
- **下载步骤**:
  1. 从HuggingFace下载模型文件（包含config.json和检查点文件）：
     ```bash
     # 使用huggingface-cli下载
     huggingface-cli download openmmlab-community/mm_grounding_dino_tiny_o365v1_goldg_grit_v3det --local-dir ../models/mm_grounding_dino_tiny_o365v1_goldg_grit_v3det/
     ```
  
  2. **下载config.py文件**（必需）：
     
     **方法1：从OpenMMLab GitHub仓库下载**
     ```bash
     # 克隆或访问mmdetection仓库
     git clone https://github.com/open-mmlab/mmdetection.git
     # 或者在浏览器访问：https://github.com/open-mmlab/mmdetection/tree/main/configs/grounding_dino
     
     # 查找对应的配置文件（通常文件名包含模型信息）
     # 例如：grounding_dino_swin-t_pretrain_obj365_goldg_grit9m_v3det.py
     
     # 将配置文件复制到模型目录
     cp mmdetection/configs/grounding_dino/grounding_dino_swin-t_pretrain_obj365_goldg_grit9m_v3det.py \
        ../models/mm_grounding_dino_tiny_o365v1_goldg_grit_v3det/config.py
     ```
     
     **方法2：直接下载配置文件**
     - 访问OpenMMLab Model Zoo或GitHub
     - 根据模型名称查找对应的配置文件
     - 下载并重命名为`config.py`放入模型目录
     
     **方法3：使用wget/curl直接下载**
     ```bash
     # 示例（请根据实际路径调整）
     wget https://raw.githubusercontent.com/open-mmlab/mmdetection/main/configs/grounding_dino/grounding_dino_swin-t_pretrain_obj365_goldg_grit9m_v3det.py \
          -O ../models/mm_grounding_dino_tiny_o365v1_goldg_grit_v3det/config.py
     ```
     
     **注意**：如果找不到完全匹配的配置文件，可以查找最接近的Grounding DINO配置文件，通常只需要调整模型路径等少量参数。
  
  3. 验证文件结构：
     ```bash
     ls -la ../models/mm_grounding_dino_tiny_o365v1_goldg_grit_v3det/
     # 应该包含：config.py 和 检查点文件
     ```

### 2. 句子嵌入模型
- **模型名称**: `all-MiniLM-L6-v2`
- **完整路径**: `../models/all-MiniLM-L6-v2/`
- **用途**: 计算密集描述短语之间的语义相似度
- **说明**:
  - 用于在检索阶段计算查询图像和候选图像的描述相似度
  - 如果已在 `description_optimization.embedding_model` 配置中使用，则无需重复下载
  - 可以从sentence-transformers库自动下载，或手动下载到指定路径

## 模型目录结构示例

```
../models/
├── mm_grounding_dino_tiny_o365v1_goldg_grit_v3det/
│   ├── config.py                    # mmdetection配置文件（必需，需单独下载）
│   ├── config.json                  # HuggingFace配置（可选）
│   ├── pytorch_model.bin            # 或 *.pth, *.ckpt 等检查点文件
│   └── ...                          # 其他模型文件
├── all-MiniLM-L6-v2/
│   ├── config.json
│   ├── pytorch_model.bin
│   ├── tokenizer.json
│   └── ...
└── ...                              # 其他已有模型
```

**注意**: 
- `config.py`是mmdetection必需的，HuggingFace仓库通常不包含此文件
- 需要从OpenMMLab官方仓库单独下载对应的config.py文件

## 验证模型安装

在运行构建脚本之前，请验证模型文件是否存在：

```bash
# 检查密集描述模型
ls -la ../models/mm_grounding_dino_tiny_o365v1_goldg_grit_v3det/

# 检查句子嵌入模型
ls -la ../models/all-MiniLM-L6-v2/
```

## 模型来源

1. **mm_grounding_dino_tiny_o365v1_goldg_grit_v3det**
   - 来源: OpenMMLab Community
   - 建议从HuggingFace或OpenMMLab官方仓库下载

2. **all-MiniLM-L6-v2**
   - 来源: sentence-transformers
   - 可以通过以下方式获取：
     ```python
     from sentence_transformers import SentenceTransformer
     model = SentenceTransformer('all-MiniLM-L6-v2')
     model.save('../models/all-MiniLM-L6-v2/')
     ```

## 注意事项

1. **模型格式**: 确保下载的模型格式与mmdetection兼容
2. **文件完整性**: 确保所有必要的模型文件都已下载
3. **路径配置**: 确认 `configs/config.yaml` 中的模型路径正确
4. **API适配**: 如果模型API与预期不同，可能需要调整 `scripts/build_dense_knowledge_base.py` 中的推理逻辑

## 下一步

完成模型下载后，请：

1. 运行 `python scripts/build_dense_knowledge_base.py` 构建密集描述知识库
2. 在 `configs/config.yaml` 中设置 `use_dense_retrieval: true` 启用新检索器
3. 测试检索效果

详细的使用说明请参考 `DENSE_RETRIEVAL_README.md`。

